<?xml version="1.0" encoding="UTF-8"?>
<definitions
  xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
  id="risk-signals"
  name="RiskSignals"
  namespace="https://primebank.com/dmn/fraud">

  <!-- INPUTS: Velocity -->

  <inputData id="txnCount5" name="transaction_count_last_5_min">
    <variable name="transaction_count_last_5_min" typeRef="number"/>
  </inputData>

  <inputData id="txnAmount5" name="amount_sum_last_5_min">
    <variable name="amount_sum_last_5_min" typeRef="number"/>
  </inputData>

  <inputData id="txnCount30" name="transaction_count_last_30_min">
    <variable name="transaction_count_last_30_min" typeRef="number"/>
  </inputData>

  <inputData id="txnAmount30" name="amount_sum_last_30_min">
    <variable name="amount_sum_last_30_min" typeRef="number"/>
  </inputData>

  <!-- DECISION: VelocityRiskScore -->
  <decision id="VelocityRiskScore" name="VelocityRiskScore">
    <variable name="VelocityRiskScore" typeRef="number"/>

    <!-- Required inputs (prevents "Unknown variable" issues) -->
    <informationRequirement>
      <requiredInput href="#txnCount5"/>
    </informationRequirement>
    <informationRequirement>
      <requiredInput href="#txnAmount5"/>
    </informationRequirement>
    <informationRequirement>
      <requiredInput href="#txnCount30"/>
    </informationRequirement>
    <informationRequirement>
      <requiredInput href="#txnAmount30"/>
    </informationRequirement>

    <literalExpression>
      <text>
        (if transaction_count_last_5_min > 3 then 15 else 0)
      + (if amount_sum_last_5_min >= 200000 then 15 else 0)
      + (if transaction_count_last_30_min > 5 then 10 else 0)
      + (if amount_sum_last_30_min >= 500000 then 10 else 0)
      </text>
    </literalExpression>
  </decision>

</definitions>
